SQL> set linesize 350
SQL> set echo on;
SQL> @HW2.sql
SQL> SET ECHO ON
SQL> 
SQL> -- Drop the tables if they are already there.
SQL> -- OK to get an Oracle error if the table(s) not found (if running script for the first time)
SQL> drop table  TEAM_PLAYER_ARENA;
drop table  TEAM_PLAYER_ARENA
            *
ERROR at line 1:
ORA-00942: table or view does not exist 


SQL> drop table  TEAM;
drop table  TEAM
            *
ERROR at line 1:
ORA-00942: table or view does not exist 


SQL> drop table  PLAYER;
drop table  PLAYER
            *
ERROR at line 1:
ORA-00942: table or view does not exist 


SQL> drop table  ARENA;
drop table  ARENA
            *
ERROR at line 1:
ORA-00942: table or view does not exist 


SQL> 
SQL> 
SQL> -- Create the tables, views, constraints, etc..
SQL> 
SQL> -- Part(A)
SQL> -- Create the TEAM table
SQL> CREATE TABLE  TEAM (    Team_ID		     INTEGER,
  2  					     Tname	     VARCHAR(15),
  3  					     Rank	     INTEGER,
  4  					     City	     VARCHAR(20),
  5  				     Championships   INTEGER,
  6  						     PRIMARY KEY (Team_id)
  7  				     );

Table created.

SQL> 
SQL> -- Create the PLAYER table
SQL> CREATE TABLE  PLAYER(   Player_ID	     INTEGER,
  2  						     Pname	     VARCHAR(30),
  3  						     Position	     VARCHAR(20),
  4  						     Draft_year      INTEGER,
  5  			     Retire_year INTEGER,
  6  						     Education	     VARCHAR(30),
  7  						     PRIMARY KEY(Player_ID)
  8  				     );

Table created.

SQL> 
SQL> -- Create the ARENA table
SQL> CREATE TABLE  ARENA(    ARENA_ID	     INTEGER,
  2  						     Aname	     VARCHAR(20),
  3  						     City	     VARCHAR(20),
  4  						     PRIMARY KEY(ARENA_ID)
  5  				     );

Table created.

SQL> 
SQL> -- Create the TEAM_PLAYER_ARENA  table
SQL> CREATE TABLE TEAM_PLAYER_ARENA (	     Team_ID	     INTEGER,
  2  									     Player_ID	     INTEGER,
  3  									     ARENA_ID	     INTEGER,
  4  									     Points	     INTEGER,
  5  									     PRIMARY KEY(Team_ID, Player_ID, ARENA_ID),
  6  									     FOREIGN KEY(Team_ID)    REFERENCES TEAM,
  7  									     FOREIGN KEY(Player_ID)  REFERENCES PLAYER,
  8  									     FOREIGN KEY(ARENA_ID)   REFERENCES ARENA
  9  				     );

Table created.

SQL> 
SQL> -- Ensure all data is removed from the tables
SQL> truncate table TEAM_PLAYER_ARENA;

Table truncated.

SQL> delete from TEAM;

0 rows deleted.

SQL> delete from PLAYER;

0 rows deleted.

SQL> delete from ARENA;

0 rows deleted.

SQL> 
SQL> 
SQL> -- INSERT THE DATA WITH NAMED FIELDS (notice that the fields are not in the order the table was created)
SQL> 
SQL> insert into     Team    (Tname,	     Rank , City, Championships, Team_ID)
  2  values( 'Clippers'  , 6 ,	     'LA'	   , 0 , 1  );

1 row created.

SQL> insert into     Team    (Tname,	     Rank , City, Championships, Team_ID)
  2  values( 'Bulls'	 , 5 ,	     'Chicago'	   , 6,      2	);

1 row created.

SQL> insert into     Team    (Tname,	     Rank , City, Championships, Team_ID)
  2  values('Hornets'	, 9 ,	     'Charlotte'   , 0,      3	);

1 row created.

SQL> insert into     Team    (Tname,	     Rank , City, Championships, Team_ID)
  2  values('Blazers'	, 2 ,	     'Portland'    , 0,      4	);

1 row created.

SQL> insert into     Team    (Tname,	     Rank , City, Championships, Team_ID)
  2  values('Spurs'	, 7 ,	     'San Antonio' , 5,      5	);

1 row created.

SQL> insert into     Team    (Tname,	     Rank , City, Championships, Team_ID)
  2  values('Mavericks' , 4 ,	     'Dallas'	   , 1,      6	);

1 row created.

SQL> 
SQL> -- INSERT THE DATA WITH ORDER OF FIELDS
SQL> insert into     PLAYER  values( 1 ,  'Chris Paul'		     ,	     'Small Forward' , 2005,  null,  'Wake Forest'	  );

1 row created.

SQL> insert into     PLAYER  values( 2 ,  'Tony Parker' 	     ,	     'Point guard'   , 2001,  null,  'INSEP'		      );

1 row created.

SQL> insert into     PLAYER  values( 3 ,  'Marco Belinelli'  ,	     'Shooting guard', 2007,  null,  'San Giovanni'	  );

1 row created.

SQL> insert into     PLAYER  values( 4 ,  'Gary Neal'		     ,	     'Power Forward' , 2007,  null,  'La Salle University');

1 row created.

SQL> insert into     PLAYER  values( 5 ,  'Kawhi Leonard'    ,	     'Forward'		     , 2011,  null,  'San Diego State'	  );

1 row created.

SQL> insert into     PLAYER  values( 6 ,  'Patty Mills' 	     ,	     'Point guard'   , 2009,  null,  'Marist College'	  );

1 row created.

SQL> insert into     PLAYER  values( 7 ,  'Tyson Chandler'   ,	     'Center'		     , 2001,  null,  'Dominguez'	  );

1 row created.

SQL> insert into     PLAYER  values( 8 ,  'Derek Fisher'	     ,	     'Shooting guard', 1996,  2014,  'Arkansas' 	      );

1 row created.

SQL> 
SQL> --  -------------------------------------
SQL> 
SQL> insert into     ARENA   values( 1 ,     'American Airlines' ,   'Miami'	  );

1 row created.

SQL> insert into     ARENA   values( 2 ,     'Moda Center'	 ,   'Portland'   );

1 row created.

SQL> insert into     ARENA   values( 3 ,     'Staples Center'	 ,   'LA'	  );

1 row created.

SQL> insert into     ARENA   values( 4 ,     'United Center'	 ,   'Chicago'	  );

1 row created.

SQL> insert into     ARENA   values( 5 ,     'TD Garden'	 ,   'Boston'	  );

1 row created.

SQL> insert into     ARENA   values( 6 ,     'ATT Center'	 ,   'San Antonio');

1 row created.

SQL> insert into     ARENA   values( 7 ,     'Philips Arena'	 ,   'Atlanta'	  );

1 row created.

SQL> 
SQL> --  ---------------------------------------------------------------------
SQL> 
SQL> insert into     TEAM_PLAYER_ARENA	 values( 1 ,	     1 ,     1 ,     20  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 1 ,     1 ,     4 ,     17  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 2 ,     3 ,     1 ,     32  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 2 ,     3 ,     2 ,     22  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 2 ,     3 ,     3 ,     13  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 2 ,     3 ,     4 ,     25  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 2 ,     3 ,     5 ,     06  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 2 ,     3 ,     6 ,     14  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 2 ,     3 ,     7 ,     18  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 2 ,     5 ,     2 ,     11  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 3 ,     3 ,     1 ,     20  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 3 ,     4 ,     2 ,     05  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 4 ,     6 ,     3 ,     23  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 4 ,     6 ,     7 ,     18  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 5 ,     2 ,     2 ,     24  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 5 ,     2 ,     4 ,     10  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 5 ,     5 ,     5 ,     25  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 5 ,     5 ,     7 ,     16  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 5 ,     6 ,     2 ,     24  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 5 ,     1 ,     4 ,     33  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 5 ,     3 ,     4 ,     31  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 5 ,     4 ,     4 ,     26  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 5 ,     5 ,     4 ,     14  );

1 row created.

SQL> insert into     TEAM_PLAYER_ARENA	     values( 5 ,     6 ,     4 ,     05  );

1 row created.

SQL> 
SQL> -- DISPALY TABLES WITH DATA
SQL> SELECT * FROM TEAM;

   TEAM_ID TNAME                 RANK CITY                 CHAMPIONSHIPS                                                                                                                                                                                                                                                                                      
---------- --------------- ---------- -------------------- -------------                                                                                                                                                                                                                                                                                      
         1 Clippers                 6 LA                               0                                                                                                                                                                                                                                                                                      
         2 Bulls                    5 Chicago                          6                                                                                                                                                                                                                                                                                      
         3 Hornets                  9 Charlotte                        0                                                                                                                                                                                                                                                                                      
         4 Blazers                  2 Portland                         0                                                                                                                                                                                                                                                                                      
         5 Spurs                    7 San Antonio                      5                                                                                                                                                                                                                                                                                      
         6 Mavericks                4 Dallas                           1                                                                                                                                                                                                                                                                                      

6 rows selected.

SQL> SELECT * FROM PLAYER;

 PLAYER_ID PNAME                          POSITION             DRAFT_YEAR RETIRE_YEAR EDUCATION                                                                                                                                                                                                                                                               
---------- ------------------------------ -------------------- ---------- ----------- ------------------------------                                                                                                                                                                                                                                          
         1 Chris Paul                     Small Forward              2005             Wake Forest                                                                                                                                                                                                                                                             
         2 Tony Parker                    Point guard                2001             INSEP                                                                                                                                                                                                                                                                   
         3 Marco Belinelli                Shooting guard             2007             San Giovanni                                                                                                                                                                                                                                                            
         4 Gary Neal                      Power Forward              2007             La Salle University                                                                                                                                                                                                                                                     
         5 Kawhi Leonard                  Forward                    2011             San Diego State                                                                                                                                                                                                                                                         
         6 Patty Mills                    Point guard                2009             Marist College                                                                                                                                                                                                                                                          
         7 Tyson Chandler                 Center                     2001             Dominguez                                                                                                                                                                                                                                                               
         8 Derek Fisher                   Shooting guard             1996        2014 Arkansas                                                                                                                                                                                                                                                                

8 rows selected.

SQL> SELECT * FROM ARENA;

  ARENA_ID ANAME                CITY                                                                                                                                                                                                                                                                                                                          
---------- -------------------- --------------------                                                                                                                                                                                                                                                                                                          
         1 American Airlines    Miami                                                                                                                                                                                                                                                                                                                         
         2 Moda Center          Portland                                                                                                                                                                                                                                                                                                                      
         3 Staples Center       LA                                                                                                                                                                                                                                                                                                                            
         4 United Center        Chicago                                                                                                                                                                                                                                                                                                                       
         5 TD Garden            Boston                                                                                                                                                                                                                                                                                                                        
         6 ATT Center           San Antonio                                                                                                                                                                                                                                                                                                                   
         7 Philips Arena        Atlanta                                                                                                                                                                                                                                                                                                                       

7 rows selected.

SQL> SELECT * FROM TEAM_PLAYER_ARENA;

   TEAM_ID  PLAYER_ID   ARENA_ID     POINTS                                                                                                                                                                                                                                                                                                                   
---------- ---------- ---------- ----------                                                                                                                                                                                                                                                                                                                   
         1          1          1         20                                                                                                                                                                                                                                                                                                                   
         1          1          4         17                                                                                                                                                                                                                                                                                                                   
         2          3          1         32                                                                                                                                                                                                                                                                                                                   
         2          3          2         22                                                                                                                                                                                                                                                                                                                   
         2          3          3         13                                                                                                                                                                                                                                                                                                                   
         2          3          4         25                                                                                                                                                                                                                                                                                                                   
         2          3          5          6                                                                                                                                                                                                                                                                                                                   
         2          3          6         14                                                                                                                                                                                                                                                                                                                   
         2          3          7         18                                                                                                                                                                                                                                                                                                                   
         2          5          2         11                                                                                                                                                                                                                                                                                                                   
         3          3          1         20                                                                                                                                                                                                                                                                                                                   

   TEAM_ID  PLAYER_ID   ARENA_ID     POINTS                                                                                                                                                                                                                                                                                                                   
---------- ---------- ---------- ----------                                                                                                                                                                                                                                                                                                                   
         3          4          2          5                                                                                                                                                                                                                                                                                                                   
         4          6          3         23                                                                                                                                                                                                                                                                                                                   
         4          6          7         18                                                                                                                                                                                                                                                                                                                   
         5          2          2         24                                                                                                                                                                                                                                                                                                                   
         5          2          4         10                                                                                                                                                                                                                                                                                                                   
         5          5          5         25                                                                                                                                                                                                                                                                                                                   
         5          5          7         16                                                                                                                                                                                                                                                                                                                   
         5          6          2         24                                                                                                                                                                                                                                                                                                                   
         5          1          4         33                                                                                                                                                                                                                                                                                                                   
         5          3          4         31                                                                                                                                                                                                                                                                                                                   
         5          4          4         26                                                                                                                                                                                                                                                                                                                   

   TEAM_ID  PLAYER_ID   ARENA_ID     POINTS                                                                                                                                                                                                                                                                                                                   
---------- ---------- ---------- ----------                                                                                                                                                                                                                                                                                                                   
         5          5          4         14                                                                                                                                                                                                                                                                                                                   
         5          6          4          5                                                                                                                                                                                                                                                                                                                   

24 rows selected.

SQL> 
SQL> -- Part(B)
SQL> -- 1.Print the player_ids and names of players of Point guards drafted after the year 2000
SQL> SELECT P.Player_ID, P.Pname
  2  FROM PLAYER P
  3  WHERE P.Draft_year > 2000 AND P.Position = 'Point guard';

 PLAYER_ID PNAME                                                                                                                                                                                                                                                                                                                                              
---------- ------------------------------                                                                                                                                                                                                                                                                                                                     
         2 Tony Parker                                                                                                                                                                                                                                                                                                                                        
         6 Patty Mills                                                                                                                                                                                                                                                                                                                                        

SQL> 
SQL> -- 2. Print the name and city of arenas that hosted a team from LA
SQL> SELECT A.Aname, A.City
  2  FROM ARENA A, TEAM_PLAYER_ARENA TPA, TEAM T
  3  WHERE A.ARENA_ID = TPA.ARENA_ID  AND TPA.Team_ID = T.Team_ID AND T.City = 'LA';

ANAME                CITY                                                                                                                                                                                                                                                                                                                                     
-------------------- --------------------                                                                                                                                                                                                                                                                                                                     
American Airlines    Miami                                                                                                                                                                                                                                                                                                                                    
United Center        Chicago                                                                                                                                                                                                                                                                                                                                  

SQL> 
SQL> -- 3.Print the names of arenas that hosted a team from Charlotte and hosted a Shooting guard. Do this query in two ways:
SQL> -- (i) as a flat select (5 points)
SQL> SELECT A.Aname
  2  FROM ARENA A, TEAM_PLAYER_ARENA TA, TEAM T, PLAYER P
  3  WHERE T.Team_ID = TA.Team_ID AND T.City = 'Charlotte' AND P.Player_ID = TA.Player_ID AND P.Position = 'Shooting guard' AND TA.ARENA_ID = A.ARENA_ID;

ANAME                                                                                                                                                                                                                                                                                                                                                         
--------------------                                                                                                                                                                                                                                                                                                                                          
American Airlines                                                                                                                                                                                                                                                                                                                                             

SQL> 
SQL> -- (ii) completely nested, i.e., using sub queries so as to avoid all JOIN clauses
SQL> SELECT A.Aname
  2  FROM ARENA A
  3  WHERE A.ARENA_ID IN (SELECT TPA.ARENA_ID
  4  			  FROM TEAM_PLAYER_ARENA TPA
  5  			  WHERE TPA.Player_ID IN (SELECT P.Player_ID
  6  						  FROM PLAYER P
  7  						  WHERE P.Position = 'Shooting guard' AND TPA.Team_ID IN (SELECT T.Team_ID
  8  									FROM TEAM T
  9  									WHERE T.City = 'Charlotte'
 10  								       )
 11  						 )
 12  			 );

ANAME                                                                                                                                                                                                                                                                                                                                                         
--------------------                                                                                                                                                                                                                                                                                                                                          
American Airlines                                                                                                                                                                                                                                                                                                                                             

SQL> 
SQL> 
SQL> -- 4.Print the names of arenas that hosted a team from Charlotte but did not host a Shooting guard (5 points)
SQL> SELECT A.Aname
  2  FROM ARENA A, TEAM_PLAYER_ARENA TA, TEAM T, PLAYER P
  3  WHERE T.Team_ID = TA.Team_ID AND T.City = 'Charlotte' AND P.Player_ID = TA.Player_ID AND P.Position <> 'Shooting guard' AND TA.ARENA_ID = A.ARENA_ID;

ANAME                                                                                                                                                                                                                                                                                                                                                         
--------------------                                                                                                                                                                                                                                                                                                                                          
Moda Center                                                                                                                                                                                                                                                                                                                                                   

SQL> 
SQL> -- 5. 5. Print the player_id and average points scored of players who scored an average of points that is greater than the average of points scored in arena 1
SQL> SELECT Player_ID, AVG(Points)
  2  FROM TEAM_PLAYER_ARENA
  3  GROUP BY Player_ID
  4  HAVING AVG(Points) > (SELECT AVG(Points)
  5  			       FROM TEAM_PLAYER_ARENA
  6  			       WHERE ARENA_ID = 1
  7  			       );

no rows selected

SQL> 
SQL> -- 6. Print the arena name & city of arenas that did not host the Bulls team
SQL> SELECT A.Aname, A.City
  2  FROM ARENA A
  3  WHERE A.ARENA_ID IN (SELECT TPA.ARENA_ID
  4  			  FROM TEAM_PLAYER_ARENA TPA
  5  			  WHERE TPA.Team_ID IN (SELECT T.Team_ID
  6  						FROM TEAM T
  7  						WHERE T.Tname <> 'Bulls'
  8  					       )
  9  			 );

ANAME                CITY                                                                                                                                                                                                                                                                                                                                     
-------------------- --------------------                                                                                                                                                                                                                                                                                                                     
American Airlines    Miami                                                                                                                                                                                                                                                                                                                                    
Moda Center          Portland                                                                                                                                                                                                                                                                                                                                 
Staples Center       LA                                                                                                                                                                                                                                                                                                                                       
United Center        Chicago                                                                                                                                                                                                                                                                                                                                  
TD Garden            Boston                                                                                                                                                                                                                                                                                                                                   
Philips Arena        Atlanta                                                                                                                                                                                                                                                                                                                                  

6 rows selected.

SQL> 
SQL> -- 7. Print the names of all retired players
SQL> SELECT P.Pname
  2  FROM PLAYER P
  3  WHERE P.Retire_year IS NOT NULL;

PNAME                                                                                                                                                                                                                                                                                                                                                         
------------------------------                                                                                                                                                                                                                                                                                                                                
Derek Fisher                                                                                                                                                                                                                                                                                                                                                  

SQL> 
SQL> -- COMMIT and save data
SQL> COMMIT;

Commit complete.

SQL> 
SQL> spool off
